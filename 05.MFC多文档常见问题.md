# MFC多文档常见问题

## 普通工程转BCG工程

见[01.普通工程转BCG.md](./01.普通工程转BCG.md)

## 多文档关闭view的标签页

在mainfrm.cpp中的CMainFrame::OnAppLook函数里删除：

```c++
//  mdiTabParams.m_bTabIcons = TRUE;//关闭view的标签页
//  EnableMDITabbedGroups (TRUE, mdiTabParams);//关闭view的标签页
```

改为

```c++
    mdiTabParams.m_bTabIcons = FALSE;
```

## 多文档中控制标题不显示文档名

```c++
    cs.style &= ~FWS_ADDTOTITLE;//此句控制标题不让他显示文档名
```

## 文档和视图绑定

每新建一个视图（view）就要新建一个与它相关联的\*Doc.h和\*Doc.cpp.

在\*.h文件中添加文档和视图的绑定

```c++
C*Doc* GetDocument( ) const;
```

同时在主程序\*.cpp中添加OpenNewDoc和CloseDoc函数。

```c++
bool CBCGAssemblyApp::OpenNewDoc( const CString& StrTarget) //创建新文档视图窗口
{
    // TODO: 在此添加命令处理程序代码
    CString strDocName;
    CDocTemplate* pSelectedTemplate;
    POSITION pos = GetFirstDocTemplatePosition();
    while ( pos != NULL)
    {
        pSelectedTemplate = (CDocTemplate*)GetNextDocTemplate(pos);
        ASSERT(pSelectedTemplate != NULL);
        ASSERT(pSelectedTemplate->IsKindOf(RUNTIME_CLASS(CDocTemplate)));
        pSelectedTemplate->GetDocString(strDocName,CDocTemplate::docName);

        if (strDocName == StrTarget)
        {
            pSelectedTemplate->OpenDocumentFile(NULL);
            return TRUE;
        }
    }
    return FALSE;
}
void CBCGAssemblyApp::CloseDoc(CString str)    //关闭文档视图窗口
{
    POSITION pos = theApp.GetFirstDocTemplatePosition();
    while (pos != NULL)
    {
        CDocTemplate *p = theApp.GetNextDocTemplate(pos);
        POSITION posdoc = p->GetFirstDocPosition();
        while (posdoc != NULL)
        {
            CDocument* pDoc = p->GetNextDoc(posdoc);
            if (pDoc != NULL)
            {
                CString str1;
                pDoc->GetDocTemplate()->GetDocString(str1,CDocTemplate::docName);
                if (str.CollateNoCase(str1) == 0)
                {
                    pDoc->OnCloseDocument();
                }
            }
        }
    }
}
```
