# 4.MFC工程添加激光跟踪仪

## 1.添加相关文件

//LtcCPPEventSink.h  
//LtcCPPEventSink.cpp  
[LTControl.dll](./LTControl.dll)  
[LTControl.tlb](./LTControl.tlb)  
[LTControl.tlh](./LTControl.tlh)  
[LTControl.tli](./LTControl.tli)

## 2.在.h文件中添加

包含目录

```c++
#include "LtcCPPEventSink.h"
#import "LTControl.dll" no_namespace, named_guids, inject_statement("#pragma pack(4)")
#include "afxwin.h"

#define  LTNUM 10 //定义激光跟踪仪最大数量，超过此数请修改
```

类中定义

```c++
//单跟踪仪
    ILTCommandSyncPtr GetSyncObj() {return m_pLTCommandSync;}
    CMapStringToPtr &GetReflectorMap() {return m_reflectorMap;}
    CMapStringToPtr m_reflectorMap;
    BOOL m_bLTConnect;//激光跟踪仪连接标志
    ILTConnectPtr m_pLTConnect;//连接激光跟踪仪指针
    CLtcCppEventSink *m_pEventSink;
    ILTCommandSyncPtr m_pLTCommandSync;
    BOOL m_bLastCmdFailed;
    BOOL m_bIsInitializing;
    BOOL m_bIsContinuousmeasuring;
    BOOL m_bIsLocal;//局部坐标系标志
    int m_nPrevRefl;//记录前一反射镜
    int m_nPrevMode;//记录前一测量方式
    int nAutoMeas;
    BOOL m_bAutoMeas;//自动测量状态
//多跟踪仪
    ILTCommandSyncPtr GetSyncObj(int nLT) {return m_pLTCommandSync[nLT];}
    CMapStringToPtr &GetReflectorMap(int nLT) {return m_reflectorMap[nLT];}
    CMapStringToPtr m_reflectorMap[LTNUM];
    ILTConnectPtr m_pLTConnect[LTNUM];            //连接激光跟踪仪指针
    CLtcCppEventSink *m_pEventSink[LTNUM];
    ILTCommandSyncPtr m_pLTCommandSync[LTNUM];
    BOOL m_bLastCmdFailed;
    BOOL m_bIsInitializing;
    BOOL m_bLTConnect[LTNUM];//激光跟踪仪连接标志
    void MyLTConnect(int nLT,CString strIP);//加My是因为LTConnect是开发包本身有的函数
    void MyLTInitialize(int nLT);
    void MyLTHome(int nLT);
    void MyLTDisConnect(int nLT);
    void MyLTStartMeas(int nLT);
    void MyLTStartStationaryMeas(int nLT);
    void MyLTStartTargetedMeas(int nLT,double dPtsVal[3]);
//上段为激光跟踪仪控制函数
```

## 3.在.cpp中添加

```c++
#include "LtcCPPEventSink.h"
#include <Afxctl.h>
#define CALL(command) \
    try {command; m_bLastCmdFailed =FALSE; if (!m_bIsInitializing) Beep(100, 100);} catch(_com_error &e) {Beep(4000, 100); m_bLastCmdFailed = TRUE; AfxMessageBox((LPCTSTR)e.Description());}

#define CALL_NO_ERRMSG(command) \
    try {command; Beep(100, 100);} catch(_com_error &e) {CString sDesc = (LPCTSTR)e.Description(); TRACE(sDesc);} // do nothing except trace out description

#define CALL_HR(command, hr) \
    try {hr = command; m_bLastCmdFailed = FALSE; if (!m_bIsInitializing) Beep(100, 100);} catch(_com_error &e) {Beep(4000, 100); m_bLastCmdFailed = TRUE; AfxMessageBox((LPCTSTR)e.Description());}
```
